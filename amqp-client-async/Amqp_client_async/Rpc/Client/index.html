<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Client (amqp-client-async.Amqp_client_async.Rpc.Client)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">amqp-client-async</a> &#x00BB; <a href="../../index.html">Amqp_client_async</a> &#x00BB; <a href="../index.html">Rpc</a> &#x00BB; Client</nav><header class="odoc-preamble"><h1>Module <code><span>Rpc.Client</span></code></h1><p>Rpc Client pattern</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span></code></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-init"><a href="#val-init" class="anchor"></a><code><span><span class="keyword">val</span> init : <span><span class="label">id</span>:string <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Connection/index.html#type-t">Connection.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-t">t</a> <a href="../../Thread/Deferred/index.html#type-t">Thread.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>Initialize a client with the <code>id</code> for tracing</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-call"><a href="#val-call" class="anchor"></a><code><span><span class="keyword">val</span> call : 
  <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?correlation_id</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">ttl</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="optlabel">?grace_time_ms</span>:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">routing_key</span>:string <span class="arrow">&#45;&gt;</span></span>
  <span><span class="label">headers</span>:<span><a href="../../../../amqp-client/Amqp_client_lib/Types/index.html#type-header">Amqp_client_lib.Types.header</a> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">_</span> <a href="../../Exchange/index.html#type-t">Exchange.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<a href="../../Spec/Basic/Content/index.html#type-t">Spec.Basic.Content.t</a> * string)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><a href="../../Message/index.html#type-message">Message.message</a> option</span> <a href="../../Thread/Deferred/index.html#type-t">Thread.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>Make an rpc call to the exchange using the routing key and headers.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">ttl</span> <p>is the message timeout in milliseconds. If the message is on the rpc endpoints queue for more than <code>ttl</code> milliseconds the message will be dead lettered and returned which will cause this function to timeout and return None.</p></li></ul><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">grace_time_ms</span> <p>is the time added to the ttl before the function times out and returns None This is to give the rpc serve a chance to process the message, in case the rpc server consumed the message from the queue close to ttl. Default 100ms.</p><p>To call directly to a named queue, use <code>call t Exchange.default ~ttl:500 ~routing_key:&quot;name_of_the_queue&quot; ~headers:[]</code></p><p><code>correlation_id</code> allows you to specify a correlation id. The id will be suffixed with an id to allow the caller to reuse correlation ids. This can be used for tracing by reusing correlation ids of incomming requests resulting in new calls. If no correlation is given the id of the <code>client</code> is used.</p><p>The function allows the call to specify both a routing key and headers regardless of the type of exchange used, as exchanges may be chained in a way where both headers and routing keys are used.</p><p>This function will timeout and return None, either if the request message is dead-lettered or if ttl + grace_time_ms has passed.</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-close"><a href="#val-close" class="anchor"></a><code><span><span class="keyword">val</span> close : <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <a href="../../Thread/Deferred/index.html#type-t">Thread.Deferred.t</a></span></span></code></div><div class="spec-doc"><p>Release resources</p></div></div></div></body></html>
